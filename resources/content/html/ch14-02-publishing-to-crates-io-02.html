<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Exporting a Convenient Public API</title>
</head>
<body>
<h1>Exporting a Convenient Public API</h1>
<p>The structure of your public API is a major consideration when publishing a
crate. People who use your crate are less familiar with the structure than you
are and might have difficulty finding the pieces they want to use if your crate
has a large module hierarchy.</p>
<p>In Chapter 7, we covered how to make items public using the <code>pub</code> keyword, and
how to bring items into a scope with the <code>use</code> keyword. However, the structure
that makes sense to you while you’re developing a crate might not be very
convenient for your users. You might want to organize your structs in a
hierarchy containing multiple levels, but then people who want to use a type
you’ve defined deep in the hierarchy might have trouble finding out that type
exists. They might also be annoyed at having to enter <code>use
my_crate::some_module::another_module::UsefulType;</code> rather than <code>use
my_crate::UsefulType;</code>.</p>
<p>The good news is that if the structure <em>isn’t</em> convenient for others to use
from another library, you don’t have to rearrange your internal organization:
Instead, you can re-export items to make a public structure that’s different
from your private structure by using <code>pub use</code>. <em>Re-exporting</em> takes a public
item in one location and makes it public in another location, as if it were
defined in the other location instead.</p>
<p>For example, say we made a library named <code>art</code> for modeling artistic concepts.
Within this library are two modules: a <code>kinds</code> module containing two enums
named <code>PrimaryColor</code> and <code>SecondaryColor</code> and a <code>utils</code> module containing a
function named <code>mix</code>, as shown in Listing 14-3.</p>
<p><Listing number="14-3" file-name="src/lib.rs" caption="An <code>art</code> library with items organized into <code>kinds</code> and <code>utils</code> modules"></p>
<p>```rust,noplayground,test_harness
{{#rustdoc_include ../listings/ch14-more-about-cargo/listing-14-03/src/lib.rs:here}}</p>
<pre><code>
&lt;/Listing&gt;

Figure 14-3 shows what the front page of the documentation for this crate
generated by `cargo doc` would look like.

&lt;img alt=&quot;Rendered documentation for the `art` crate that lists the `kinds` and `utils` modules&quot; src=&quot;img/trpl14-03.png&quot; class=&quot;center&quot; /&gt;

&lt;span class=&quot;caption&quot;&gt;Figure 14-3: The front page of the documentation for `art`
that lists the `kinds` and `utils` modules&lt;/span&gt;

Note that the `PrimaryColor` and `SecondaryColor` types aren’t listed on the
front page, nor is the `mix` function. We have to click `kinds` and `utils` to
see them.

Another crate that depends on this library would need `use` statements that
bring the items from `art` into scope, specifying the module structure that’s
currently defined. Listing 14-4 shows an example of a crate that uses the
`PrimaryColor` and `mix` items from the `art` crate.

&lt;Listing number=&quot;14-4&quot; file-name=&quot;src/main.rs&quot; caption=&quot;A crate using the `art` crate’s items with its internal structure exported&quot;&gt;

```rust,ignore
{{#rustdoc_include ../listings/ch14-more-about-cargo/listing-14-04/src/main.rs}}
</code></pre>
<p></Listing></p>
<p>The author of the code in Listing 14-4, which uses the <code>art</code> crate, had to
figure out that <code>PrimaryColor</code> is in the <code>kinds</code> module and <code>mix</code> is in the
<code>utils</code> module. The module structure of the <code>art</code> crate is more relevant to
developers working on the <code>art</code> crate than to those using it. The internal
structure doesn’t contain any useful information for someone trying to
understand how to use the <code>art</code> crate, but rather causes confusion because
developers who use it have to figure out where to look, and must specify the
module names in the <code>use</code> statements.</p>
<p>To remove the internal organization from the public API, we can modify the
<code>art</code> crate code in Listing 14-3 to add <code>pub use</code> statements to re-export the
items at the top level, as shown in Listing 14-5.</p>
<p><Listing number="14-5" file-name="src/lib.rs" caption="Adding <code>pub use</code> statements to re-export items"></p>
<p>```rust,ignore
{{#rustdoc_include ../listings/ch14-more-about-cargo/listing-14-05/src/lib.rs:here}}</p>
<pre><code>
&lt;/Listing&gt;

The API documentation that `cargo doc` generates for this crate will now list
and link re-exports on the front page, as shown in Figure 14-4, making the
`PrimaryColor` and `SecondaryColor` types and the `mix` function easier to find.

&lt;img alt=&quot;Rendered documentation for the `art` crate with the re-exports on the front page&quot; src=&quot;img/trpl14-04.png&quot; class=&quot;center&quot; /&gt;

&lt;span class=&quot;caption&quot;&gt;Figure 14-4: The front page of the documentation for `art`
that lists the re-exports&lt;/span&gt;

The `art` crate users can still see and use the internal structure from Listing
14-3 as demonstrated in Listing 14-4, or they can use the more convenient
structure in Listing 14-5, as shown in Listing 14-6.

&lt;Listing number=&quot;14-6&quot; file-name=&quot;src/main.rs&quot; caption=&quot;A program using the re-exported items from the `art` crate&quot;&gt;

```rust,ignore
{{#rustdoc_include ../listings/ch14-more-about-cargo/listing-14-06/src/main.rs:here}}
</code></pre>
<p></Listing></p>
<p>In cases where there are many nested modules, re-exporting the types at the top
level with <code>pub use</code> can make a significant difference in the experience of
people who use the crate. Another common use of <code>pub use</code> is to re-export
definitions of a dependency in the current crate to make that crate's
definitions part of your crate’s public API.</p>
<p>Creating a useful public API structure is more an art than a science, and you
can iterate to find the API that works best for your users. Choosing <code>pub use</code>
gives you flexibility in how you structure your crate internally and decouples
that internal structure from what you present to your users. Look at some of
the code of crates you’ve installed to see if their internal structure differs
from their public API.</p>
</body>
</html>